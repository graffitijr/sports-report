<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>delete pages</title>
    <style>
        body, html {
            background-color: black;
        }
        #main-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 95vw;
            height: 95vh;
        }
        .text-class {
            color: white;
        }
    </style>
</head>
<body>
<div id="main-container">
    <h1 class="text-class">Delete Stories</h1>
    <div id="list-stories-container">

    </div>
    <input type="text" id="choice" placeholder="Enter story to delete">
    <button onclick="DeleteStory()" id="delete-stories">Delete Stories</button>
</div>
<script>
    const StoryContainer = document.getElementById('list-stories-container');
    const InputChoice = document.getElementById('choice');

    const BaseWorkerLink = "https://worker.fhcsports.site";

    document.addEventListener('DOMContentLoaded', () => {
        RenderStories();
    })

    async function DeleteStory() {
        let name = new URL(window.location.href).searchParams.get("name");

        let StoryToDelete = InputChoice.value;

        let res = await fetch(BaseWorkerLink + "/remove-story", {
            method: "POST",
            headers: {"Content-Type": "application/json"},
            credentials: "include",
            body: JSON.stringify([name, StoryToDelete])
        })
        if (!res.ok) {
            alert("error")
        }
        let text = await res.text();
        if (text === "attempted to remove") {
            alert("attempted to remove")
        }
        InputChoice.value = "";
        window.location.reload();
    }

    async function RenderStories() {
        let stories = await GetContent()

        stories.forEach(story => {
            const text = document.createElement("p");
            text.textContent = story.title;
            text.className = "text-class";

            StoryContainer.append(text);
        })

    }

    async function GetContent() {
        const res = await fetch(BaseWorkerLink + "/get-content");

        if (!res.ok) {
            alert("no response from server");
        }

        return await res.json();
    }
</script>
</body>
</html>
